<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorator="layout/mainLayout">

<head>
	<th:block th:replace="fragments/head_inc :: head_inc" />
</head>

<body id="body">

	<div id="wrap">
		<div class="container">
			<div id="content">
                <div class="page_info_area">
                    <div class="left">
                        <div class="location_area">
                            
                        </div>
                        <div class="title_area">
                            <p>데이터셋 조회</p>
                            <a href="#" class="reload_btn" title="새로고침">새로고침</a>
                            <a href="#" class="help_btn" title="도움말">도움말</a>
                        </div>
                    </div>
                    <div class="right">
                        <div class="button_area">
                            <button class="btn" title="훈련데이터 다운로드" onclick="fnCommFileDown('DATASET', $('#datasetSn').val())">다운로드</button>
                            <button class="btn" title="닫기" onclick="fnExit();">닫기</button>
                        </div>
                    </div>
                </div>
                
                <div class="content_area">
                	<form>
						<input type="hidden" id="dst" name="dst" th:value="${paramMap.dst}" />
						<input type="hidden" id="itemSn" name="itemSn" th:value="${paramMap.itemSn}" />
						<input type="hidden" id="datasetSn" name="datasetSn" th:value="${datasetInfo.datasetSn}" />
						<input type="hidden" id="hderIndx" name="hderIndx" th:if="${paramMap.dst} == 'L'" th:value="${datasetInfo.hderIndx}" />
						<input type="hidden" id="exclRowCnt" name="exclRowCnt" th:if="${paramMap.dst} == 'L'" th:value="${datasetInfo.exclRowCnt}" />
						<input type="hidden" id="dataFlpth" name="dataFlpth" th:if="${paramMap.dst} == 'L'" th:value="${datasetInfo.dataFlpth}" />
					</form>
					<div class="division20">
						<div class="search_wrap">
							<table class="search fixed">
								<colgroup>
									<col style="width:110px;" />
									<col style="width:auto;" />
									<col style="width:60px;" />
									<col style="width:110px;" />
									<col style="width:auto;" />
									<col style="width:60px;" />
									<col style="width:110px;" />
									<col style="width:auto;" />
								</colgroup>
								<tbody>
									<tr>
										<th scope="row"><label for="datasetNm">데이터셋 명</label></th>
										<td>
											<input type="text" class="in_w100" id="datasetNm" name="datasetNm" th:if="${paramMap.dst} == 'S'" th:value="${datasetInfo.datasetNm}" readonly />
											<input type="text" class="in_w100" id="datasetNm" name="datasetNm" th:if="${paramMap.dst} == 'L'" th:value="${datasetInfo.lrnDatasetNm}" readonly />
										</td>
										<td></td>
										<th scope="row"><label for="datasetTy">데이터셋 구분</label></th>
										<td>
											<input type="text" class="in_w100" id="datasetTy" name="datasetTy" th:if="${paramMap.dst} == 'S'" value="원천데이터셋" readonly />
											<input type="text" class="in_w100" id="datasetTy" name="datasetTy" th:if="${paramMap.dst} == 'L'" value="학습데이터셋" readonly />
										</td>
										<td></td>
										<th scope="row"><label for="dataKbSize">데이터 크기(KB)</label></th>
										<td><input type="text" class="in_w100" id="dataKbSize" name="dataKbSize" th:value="${datasetInfo.dataKbSize}" readonly /></td>
									</tr>
									<tr>
										<th scope="row"><label for="datasetLayout">데이터셋 Layout</label></th>
										<td>
											<input type="text" class="in_w100" id="datasetLayout" name="datasetLayout" th:value="${datasetInfo.dataRowCnt} + ' rows * ' + ${datasetInfo.dataColCnt} + ' cols'" readonly />
											<input type="hidden" id="dataRowCnt" name="dataRowCnt" th:value="${datasetInfo.dataRowCnt}" />
											<input type="hidden" id="previewSize" name="previewSize" th:value="${previewSize}" />
										</td>
										<td></td>
										<th scope="row"><label for="dataOrginlFlpth">파일명</label></th>
										<td><input type="text" class="in_w100" id="dataOrginlFlpth" name="dataOrginlFlpth" th:value="${datasetInfo.dataOrginlFlpth}" readonly /></td>
										<td></td>
										<th scope="row"><label for="dataFlpth">물리파일경로</label></th>
										<td><input type="text" class="in_w100" id="dataFlpth" name="dataFlpth" th:value="${datasetInfo.dataFlpth}" readonly /></td>
									</tr>
									<tr>
										<th scope="row"><label for="datasetDc">데이터 설명</label></th>
										<td colspan="4">
											<input type="text" class="in_w100" id="datasetDc" name="datasetDc" th:if="${paramMap.dst} == 'S'" th:value="${datasetInfo.datasetDc}" readonly />
											<input type="text" class="in_w100" id="datasetDc" name="datasetDc" th:if="${paramMap.dst} == 'L'" th:value="${datasetInfo.lrnDatasetDc}" readonly />
										</td>
										<td></td>
										<th scope="row"><label for="registInfo">등록일시(아이디)</label></th>
										<td><input type="text" class="in_w100" id="registInfo" name="registInfo" th:value="${datasetInfo.regDt} + ' (' + ${datasetInfo.regUserId} + ')'" readonly /></td>
									</tr>
									<tr>
										<th scope="row"><label for="dataOriginDc">데이터 출처</label></th>
										<td colspan="7"><input type="text" class="in_w100" id="dataOriginDc" name="dataOriginDc" th:value="${datasetInfo.dataOriginDc}" readonly /></td>
									</tr>
								</tbody>
							</table>
						</div>
					</div>
					
					
					<div class="view_wrap division30" id="charts">
						<div class="division">
							<div id="dv_uniqCharts" style="float:left; width:30%; height:500px;"></div>
	
							<div id="dv_targetCharts" style="float:left; width:30%; height:500px;"></div>
						
							<div id="dv_boxPlot" style="float:left; width:40%; height:500px;"></div>
						</div>
					</div>
					
					
					<div class="division30">
						<div style="overflow:scroll; width:100%; height:600px;" class="table_area">
						
							<div class="popup layer" id="modal_preview" style="width:250px; border:2px solid #324266; border-radius:5px">

								<div class="pop_content" id="previewContent" style="text-align:center;">
									<br><br>
								</div>
								<div class="pop_footer">
									<button class="btn sm bg_navy txt_white" onclick="fnCloseModal('modal_preview'); return false;">확인</button>
								</div>		
							</div>
						
	                        <table style="word-break:keep-all; width:calc(100% - 1px);" class="list" id="tb_data_table">
	                        	<thead>
		                        	<tr>
										<th style="min-width:120px;" th:each="header: ${headerList}" th:text="${header}">
										</th>
									</tr>
								</thead>
								<tbody>
									<th:block th:each="bodyRow, index : ${bodyList}">
										<tr>
											<td th:each="header: ${headerList}" th:text="${bodyRow.get(header)}"></td>
										</tr>
									</th:block>
								</tbody>
	                        </table>
	                    </div>
					</div>
					
                </div>
			
			</div>
		</div>
	</div>



<script type="text/javascript">

$(document).ready(function() {
	
	if ($("#dst").val() == "L") {
		
		$.ajax({
			url: "/json/dataset/getTrainDataAnalysisInfo"
			, method: "POST"
			, contentType: "application/json"
			, data: JSON.stringify({
				traingDataFlpth : $("#dataFlpth").val()
				, exclRowCnt : $("#exclRowCnt").val()
				, traingTrgetHderIndx : $("#hderIndx").val()
				, lrnDatasetSn : $("#itemSn").val()
			})
			, success: function(data) {
				
				var dataUniqObj = data.BY_FEATURE_UNIQUE;
				var dataUniqObjList = new Array(); 
				for(key in dataUniqObj) {
					var obj = new Object();
					obj.name = key;
					obj.value = dataUniqObj[key];
						
					dataUniqObjList[dataUniqObjList.length] = obj;
				}
				fnDrawUPieChart("dv_uniqCharts", dataUniqObjList);
					
				var dataTargetObj = data.BY_LABEL;
				var dataTargetObjList = new Array();
				for(key in dataTargetObj) {
					var obj = new Object();
					obj.name = key;
					obj.value = dataTargetObj[key];
					dataTargetObjList[dataTargetObjList.length] = obj;
				}
				fnDrawRPieChart("dv_targetCharts", dataTargetObjList);
					
				fnDrawBoxPlot("dv_boxPlot", data.BY_FEATURE_CONTENTS);
				
			}
		});
		
	} else {
		$("#charts").hide();
	}
	
	if ($("#dataRowCnt").val() > 1000) {
		$("#modal_preview").addClass('on');
		if ($("#dst").val() == "L") {
			$("#modal_preview").css({
				"position":"absolute",
				"top":Math.max(0, (($(parent.window).height() - $("#modal_preview").outerHeight()) / 2)) + 666 + "px",
				"left":Math.max(0, (($(window).width() - $("#modal_preview").outerWidth()) / 2)) + "px"
			});
		} else {
			$("#modal_preview").css({
				"position":"absolute",
				"top":Math.max(0, (($(parent.window).height() - $("#modal_preview").outerHeight()) / 2)) + 100 + "px",
				"left":Math.max(0, (($(window).width() - $("#modal_preview").outerWidth()) / 2)) + "px"
			});
		}
		var text = "미리보기 데이터 " + $("#previewSize").val() + "건 입니다.";
		$("#previewContent").append(text);
	}
		
});


function fnExit() {
	window.close();
}


function fnDrawUPieChart(id, dataList) {
	var option;
	option = {title: {text: 'Feature Unique Count', subtext: '', left: 'center'}
		, tooltip: {trigger: 'item'}
		// , legend: {orient: 'vertical', left: 'left'}
		, series: [{name: 'Feature Unique Count'
			, type: 'pie'
			, radius: '50%'
			, data: dataList
			, emphasis: {itemStyle: {shadowBlur: 10
				, shadowOffsetX: 0
				, shadowColor: 'rgba(0, 0, 0, 0.5)'
				}
			}
		}]
	};

	var chartDom = document.getElementById(id);
	var myChart = echarts.init(chartDom);
	option && myChart.setOption(option);	
	
}


function fnDrawRPieChart(id, dataList) {
	var option;
	option = {title: {text: 'Label(target) Rate', subtext: '', left: 'center'}
		, tooltip: {trigger: 'item'}
		// , legend: {orient: 'vertical', left: 'left'}
		, series: [{name: 'Target Count'
			, type: 'pie'
			, radius: '50%'
			, data: dataList
			, emphasis: {itemStyle: {shadowBlur: 10
				, shadowOffsetX: 0
				, shadowColor: 'rgba(0, 0, 0, 0.5)'
				}
			}
		}]
	};

	var chartDom = document.getElementById(id);
	var myChart = echarts.init(chartDom);
	option && myChart.setOption(option);	
	
}


function fnDrawBoxPlot(id, data) {
	var option;
	
	option = {title: [{text: 'Feature Boxplot'
				,left: 'center'}
			]
		, dataset: [{source: data}
			, {transform: {type: 'boxplot', config: {itemNameFormatter: 'exer {value}'}}
			}
			, {fromDatasetIndex: 1, fromTransformResult: 1}
		]
		, tooltip: {trigger: 'item', axisPointer: {type: 'shadow'}}
		, grid: {left: '10%', right: '10%', bottom: '15%'}
		, xAxis: {type: 'category'
			, axisLabel: {show:true}
			, boundaryGap: true
			, nameGap: 10
			, splitArea: {show: false}
			, splitLine: {show: false}
			}
		, yAxis: {type: 'value'
			, name: 'Score'
			, splitArea: {show: true}}
		, series: [{name: 'boxplot', type: 'boxplot', datasetIndex: 1}
			, {name: 'outlier', type: 'scatter', datasetIndex: 2}
		]
	};
	
	var chartDom = document.getElementById(id);
	var myChart = echarts.init(chartDom);
	option && myChart.setOption(option);
}

</script>
</body>
</html>

