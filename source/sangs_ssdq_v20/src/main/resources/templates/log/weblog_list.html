<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorator="layout/mainLayout">

<head>
	<th:block th:replace="fragments/head_inc :: head_inc" />
</head>

<body>
	<div id="wrap">
		<div class="container">
			<div id="content">
			
				<div class="page_info_area">
					<div class="left">
						<div class="title_area">
							<p>웹로그 관리</p>
							<a href="#" class="reload_btn" title="새로고침">새로고침</a>
						</div>
					</div>
					<div class="right">
						<div class="button_area">
							<button class="btn" title="조회" onclick="fnSearch(); return false;">조회</button>
						</div>
					</div>
				</div><!--// page_info_area -->
				
				
				<div class="content_area">
					<div class="division20">
						<div class="search_wrap">
							<table class="search fixed">
								<caption>조회 조건</caption>
								<colgroup>
									<col style="width: 5%;" />
									<col style="width: 25%;" />
									<col style="width: 5%;" />
									<col style="width: 20%;" />
									<col style="width: 5%;" />
									<col style="width: 15%;" />
									<col style="width: 10%;" />
									<col style="width: 10%;" />
								</colgroup>
								<tbody>
									<tr>
										<th scope="row">발생일자</th>
										<td style="white-space: nowrap;">
											<div class="calendar_box">
												<input type="text" id="searchBgnDe" name="searchBgnDe" autocomplete="off" title="발생시작일" />
											</div> ~
											<div class="calendar_box">
												<input type="text" id="searchEndDe" name="searchEndDe" autocomplete="off" title="발생종료일" />
											</div>
										</td>
										<th class="alignc" scope="row"><label for="cntnUrl">접속 URL</label></th>
										<td><input type="text" class="in_w95" name="cntnUrl" id="cntnUrl"/></td>
										<th class="alignc" scope="row"><label for="rqesterId">요청자</label></th>
										<td><input type="text" class="in_w70" name="rqesterId" id="rqesterId"/></td>
										<td>
											<div style="display:flex;">
												<input type="checkbox" id="onlyMenuYn" name="onlyMenuYn" value="Y"/>
												<label for="onlyMenuYn">메뉴만 조회</label>
											</div>
										</td>
										<td>
											<div style="display:flex;">
												<input type="checkbox" id="onlyNrmltN" name="onlyNrmltN" value="N"/>
												<label for="onlyNrmltN">비정상만 조회</label>
											</div>
										</td>
									</tr>
								</tbody>
							</table>
						</div>
					</div><!--// division20 -->

				
					<div class="division20">
						<div class="card">
							<div class="left" data-width="0">
								<div class="table_area marginb25">
									<table class="list fixed" id="logTable">
										<caption>접속 로그</caption>
										<colgroup>
											<col style="width: 5%" />
											<!--
											<col style="width: 5%" />
											-->
											<col style="width: 15%" />
											<col style="width: auto" />
											<col style="width: auto" />
											<col style="width: 5%" />
											<col style="width: 12%" />
											<col style="width: 6%" />
											<col style="width: 10%" />
										</colgroup>
										<thead>
											<tr>
												<th scope="col">순번</th>
												<!--
												<th scope="col">시스템구분</th>
												-->
												<th scope="col">요청ID</th>
												<th scope="col">메뉴명</th>
												<th scope="col">접속URL</th>
												<th scope="col">정상여부</th>
												<th scope="col">발생일시</th>
												<th scope="col">요청자</th>
												<th scope="col">요청자IP</th>
											</tr>
										</thead>
										<tbody>
											<tr class="fwk_templete_row">
												<td>#{FWK_TR_NO}</td>
												<!--
												<td>#{sysSeCd}</td>
												-->
												<td>#{requstId}</td>
												<td class="alignl">#{menuNm}</td>
												<td class="alignl">#{url}</td>
												<td>#{nrmltYn}</td>
												<td>#{occrrncDe}</td>
												<td>#{rqesterNm}</td>
												<td>#{rqesterIp}</td>
											</tr>
										</tbody>
									</table>
								</div>
								<div class="pagination_area marginb25" id="dv_paging"></div>
							</div><!--// table_area -->
						</div>
					</div>
				</div><!-- content_area -->
				
			</div><!-- content -->
		</div><!-- container -->
	</div><!-- wrap -->

<script>

$(document).ready(function(){

	// datepicker의 조회조건의 from을 1년전 부터 오늘까지로 셋팅해줌
	fnSet1YearFromTo("#searchBgnDe", "#searchEndDe");
	
    $("#cntnUrl, #rqesterId").on("keyup", function(event) {
		if(event.keyCode == 13)
			fnSearch();
	});

    fnSearch();
});

function fnSearch(pageNum){
	if(!pageNum){
		pageNum = 1;
	}

	// 날짜 조회조건 체크
	if(!fnSearcDateChk($("#searchBgnDe").val(), $("#searchEndDe").val())) return;


	var onlyMenuYn = "N";
	if($("#onlyMenuYn").is(":checked"))
		onlyMenuYn = "Y";

	var onlyNmrltN = "";
	if($("#onlyNrmltN").is(":checked"))
		onlyNmrltN = "N";

	$.ajax({
		url: "/json/webLog/selectWebLogList"
		, method : "POST"
		, dataType:'json'
		, contentType:"application/json"
		, data: JSON.stringify({
			pageIndex : pageNum
			, url: fnUnderbarChgVar($("#cntnUrl").val())
			, rqesterId : fnUnderbarChgVar($("#rqesterId").val())
			, searchBgnDe : $("#searchBgnDe").val()
			, searchEndDe : $("#searchEndDe").val()
			, searchSysSeCd : $("#searchSysSeCd").val()
			, onlyMenuYn : onlyMenuYn
			, nrmltYn : onlyNmrltN
		})
		, success: function(data){

			fnBindTableValue("logTable", data.list, data.pagingInfo);

			fnSetPaging("dv_paging", data.pagingInfo);
		}
	});
}
	
</script>

<th:block th:replace="fragments/footer_inc :: footer_inc" />
</body>