<html th:lang = "ko" xmlns:th="http://www.thymeleaf.org">

<th:block th:fragment="std_change_hist_list_inc">
	<div class="pop_header">
		<p class="title">변경승인이력상세조회</p>
		<button class="btn_ic btn_pop_close" onclick="fnCloseModal('changehistlist_modal');">닫기</button>
	</div>
	<div class="pop_content">
		<div class="tbl_top">
			<p class="tit v2">
				<span>조회대상 : <span id="histDataNm"></span></span>
			</p>
			<div class="btn_wrap">
				<input type="hidden" name="histStdSetSn" id="histStdSetSn" />
				<input type="hidden" name="histLocation" id="histLocation" />
				<input type="hidden" name="histSn" id="histSn" />
				<button class="btn sm" onclick="fnHistSearch(); return false;">조회</button>
			</div>
		</div>
		<div class="search_wrap" style="margin-right: 0px;margin-top:7px; margin-bottom: 10px;">
			<table class="search fixed">
				<colgroup>
					<col width="10%"/>
					<col width="1%"/>
					<col width="25%"/>
					<col width="3%"/>
					<col width="12%"/>
					<col width="1%"/>
					<col width="auto"/>
					<col width="25%"/>
				</colgroup>
				<tbody>
					<tr>
						<th scope="row">
							<div class="selectbox">
								<select id="histSltDt" name="histSltDt">
									<option value="">전체</option>
									<option value="rqstDt">요청일자</option>
									<option value="prcsDt">승인일시</option>
								</select>
							</div>
						</th>
						<td></td>
						<td>
							<div class="calendar_box">
                            	<input type="text"  id="histBeginDtFrom" name="histBeginDtFrom"/>
							</div>
                            ~
                            <div class="calendar_box">
                            	<input type="text"  id="histBeginDtTo"  name="histBeginDtTo"/>
							</div>
						</td>
						<td></td>
						<th scope="row">
							<div class="selectbox">
								<select id="histSltText" name="histSltText">
									<option value="">전체</option>
									<option value="aprvSttusCdNm">승인항목</option>
									<option value="chgIemNm">변경항목명</option>
									<option value="bfchgCn">변경 전 내용</option>
									<option value="aftchCn">변경 후 내용</option>
									<option value="regUserId">요청자</option>
									<option value="chgUserId">승인자</option>
								</select>
							</div>
						</th>
						<td></td>
						<td>
							<input type="text" class="in_w100" id="histSearchText" name="histSearchText" />
						</td>
						<td></td>
					</tr>
				</tbody>
			</table>
		</div>
		<div class="tbl_wrap">
			<div class="tbl_wrap" style="height:400px;">
				<div class="card">
					<table id="tb_histlist_table" class="list margint0">
						<colgroup>
							<col width="6%"/>
							<col width="auto"/>
							<col width="auto"/>
							<col width="8%"/>
							<col width="13%"/>
							<col width="13%"/>
							<col width="13%"/>
							<col width="10%"/>
							<col width="10%"/>
						</colgroup>
						<thead>
							<tr>
								<th>No</th>
								<th>요청일자</th>
								<th>승인일시</th>
								<th>승인항목</th>
								<th>변경항목명</th>
								<th>변경 전 내용</th>
								<th>변경 후 내용</th>
								<th>요청자</th>
								<th>승인자(승인,반려)</th>
							</tr>
						</thead>											
						<tbody>
							<tr class="fwk_templete_row">
								<td style="text-align:center">#{FWK_TR_NO}</td>
								<td style="text-align: center">#{rqstDt}</td>
								<td style="text-align: center">#{prcsDt}</td>
								<td style="text-align: center">#{aprvSttusCdNm}</td>
								<td style="text-align: center">#{chgIemNm}</td>
								<td style="text-align: center">#{bfchgCn}</td>
								<td style="text-align: center">#{aftchCn}</td>
								<td style="text-align: center">#{regUserId}</td>
								<td style="text-align: center">#{chgUserId}</td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
		</div>
	</div>
	<div class="pop_footer">
    </div>
<script type="text/javascript">

$(document).ready(function() {
	
	if(!fnChkStdSet())
		return;
	
	fnHistSearch();
	$("#histBeginDtFrom, #histBeginDtTo").datepicker();
	//histmodal
	$("#histSearchText").on("keyup", function(event) {
		if (event.keyCode == 13) {
			fnHistSearch();
		}
	});
	
});

function fnHistSearch() {

 	var histSn = $("#histSn").val(); 			// 단어순번,용어순번,도메인순번 hidden value
	var histLocation = $("#histLocation").val();// 'wrd','word','domn' hidden value
	
	var sltDt = $("#histSltDt").val();
	var beginDtFrom = $("#histBeginDtFrom").val();
	var beginDtTo = $("#histBeginDtTo").val();
	
	if(beginDtFrom != "" || beginDtTo!= ""){
		if(sltDt == ""){
			alert("검색날짜 조건을 선택해주세요.");
			return;
		}
	} else {
		if(sltDt != ""){
			alert("날짜를 선택해주세요.");
			return;		
		}
	}

/* 	if(beginDtFrom !="") {
		if(beginDtTo == "") {
			beginDtTo = "9999-12-31";
		}
	} else if(beginDtTo !="") {
		if(beginDtFrom == "") {
			beginDtFrom = "0000-01-01";
		}
	} */
	
	var sltText = $("#histSltText").val();
	var searchText = $("#histSearchText").val();
	
	if(searchText != "") {
		if(sltText == ""){
			alert("검색 조건을 선택해주세요.");
			return;
		}	
	} else {
		if(sltText != ""){
			alert("검색 내용을 작성해주세요.");
			return;
		}
	}
	
	$.ajax({
		url : "/json/stdDicary/getStdDicaryStdChangeHistList"
		, method : "POST"
		, contentType : 'application/json'
		, data : JSON.stringify({
			histSn : histSn
			, sltDt : sltDt
			, sltText : sltText
			, histLocation : histLocation
			, searchText : searchText
			, beginDtFrom : fnRemoveDateDelim(beginDtFrom)
			, beginDtTo : fnRemoveDateDelim(beginDtTo)
			, stdSetSn : $("#histStdSetSn").val()
			, detailPageYn : "Y"
		})
		, success : function(data) {

			fnBindTableValue("tb_histlist_table", data.list);
			
			var info = data.info;

			if (histLocation == "domn") {
				$("#histDataNm").text(info.domnNm);
			} else if (histLocation == "wrd") {
				$("#histDataNm").text(info.wrdNm);
			} else if (histLocation == "word") {
				$("#histDataNm").text(info.wordNm);
			}
			
		}
	});

}
</script>
</th:block>
